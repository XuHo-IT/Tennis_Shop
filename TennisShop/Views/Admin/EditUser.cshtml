@model BussinessObject.User
@{
    ViewData["Title"] = "Edit User";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var initials = string.Join("", (Model.FullName ?? "U").Split(" ", StringSplitOptions.RemoveEmptyEntries).Take(2).Select(s => s[0])).ToUpper();
}

<div class="container-fluid px-4 py-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="page-heading mb-1">Edit User</h2>
            <p class="text-muted mb-0">Update user information and permissions</p>
        </div>
        <a asp-action="Users" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Users
        </a>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <form asp-action="EditUser" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="CreatedAt" />
        <input type="hidden" asp-for="PasswordHash" />
        
        <div class="row g-4">
            <!-- Left Column: User Information -->
            <div class="col-lg-8">
                <!-- Personal Information -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-user me-2"></i>Personal Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="FullName" class="form-label">Full Name <span class="text-danger">*</span></label>
                            <input asp-for="FullName" class="form-control form-control-lg" placeholder="Enter full name" required />
                            <span asp-validation-for="FullName" class="text-danger small"></span>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="Email" class="form-label">Email Address <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="far fa-envelope"></i></span>
                                    <input asp-for="Email" type="email" class="form-control" placeholder="user@example.com" required />
                                </div>
                                <span asp-validation-for="Email" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Phone" class="form-label">Phone Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input asp-for="Phone" type="tel" class="form-control" placeholder="+1 (555) 000-0000" />
                                </div>
                                <span asp-validation-for="Phone" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="mt-3">
                            <label asp-for="Address" class="form-label">Address</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                <textarea asp-for="Address" class="form-control" rows="3" placeholder="Enter full address"></textarea>
                            </div>
                            <span asp-validation-for="Address" class="text-danger small"></span>
                        </div>
                    </div>
                </div>

                <!-- Role & Permissions -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Role & Permissions</h5>
                    </div>
                    <div class="card-body">
                        <label asp-for="RoleId" class="form-label">User Role <span class="text-danger">*</span></label>
                        <select asp-for="RoleId" class="form-select form-select-lg" required>
                            @foreach (var role in ViewBag.Roles as List<BussinessObject.UserRole>)
                            {
                                <option value="@role.Id" selected="@(Model.RoleId == role.Id)">
                                    @(role.Name == "Admin" ? "üõ°Ô∏è" : "üë§") @role.Name
                                </option>
                            }
                        </select>
                        <span asp-validation-for="RoleId" class="text-danger small"></span>
                        
                        <div class="alert alert-info mt-3 mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Admin:</strong> Full access to all features and settings<br>
                            <strong>Customer:</strong> Standard user with shopping privileges
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: User Details & Actions -->
            <div class="col-lg-4">
                <!-- User Profile Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>User Profile</h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="user-avatar mx-auto mb-3" style="width: 100px; height: 100px; font-size: 2.5rem;">
                            @initials
                        </div>
                        <h5 class="mb-1">@Model.FullName</h5>
                        <p class="text-muted mb-3">@Model.Email</p>
                        <span class="badge-tag @(Model.Role?.Name == "Admin" ? "badge-danger" : "badge-primary")">
                            @Model.Role?.Name
                        </span>
                    </div>
                </div>

                <!-- User Details -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Account Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="info-group mb-3">
                            <label class="text-muted small mb-1">User ID</label>
                            <div class="fw-bold">#@Model.Id</div>
                        </div>
                        <div class="info-group mb-3">
                            <label class="text-muted small mb-1">Member Since</label>
                            <div class="fw-semibold">@Model.CreatedAt?.ToString("MMM dd, yyyy")</div>
                            <small class="text-muted">@Model.CreatedAt?.ToString("HH:mm")</small>
                        </div>
                        <div class="info-group">
                            <label class="text-muted small mb-1">Account Status</label>
                            <div>
                                <span class="status-badge status-active">Active</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-dark btn-lg">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                            <a asp-action="Users" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="card border-0 shadow-sm border-danger">
                    <div class="card-header bg-danger text-white border-bottom-0">
                        <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Danger Zone</h6>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small mb-3">Irreversible actions that permanently affect this user</p>
                        
                        @if (Model.RoleId != 1)
                        {
                            <form method="post" action="@Url.Action("ChangeUserRole", "Admin", new { id = Model.Id })" class="mb-2">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="roleId" value="1" />
                                <button type="submit" class="btn btn-warning w-100" onclick="return confirm('Promote this user to Admin?')">
                                    <i class="fas fa-crown me-2"></i>Promote to Admin
                                </button>
                            </form>
                        }
                        else
                        {
                            <form method="post" action="@Url.Action("ChangeUserRole", "Admin", new { id = Model.Id })" class="mb-2">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="roleId" value="2" />
                                <button type="submit" class="btn btn-info w-100" onclick="return confirm('Demote this admin to Customer?')">
                                    <i class="fas fa-user me-2"></i>Demote to Customer
                                </button>
                            </form>
                        }
                        
                        <form method="post" action="@Url.Action("DeleteUser", "Admin", new { id = Model.Id })" 
                              onsubmit="return confirm('‚ö†Ô∏è DELETE USER?\n\nThis will permanently delete:\n‚Ä¢ User account\n‚Ä¢ Order history\n‚Ä¢ All associated data\n\nThis action CANNOT be undone!\n\nType DELETE to confirm.')">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger w-100">
                                <i class="fas fa-trash me-2"></i>Delete User
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<style>
.form-label {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.5rem;
}

.form-control:focus,
.form-select:focus {
    border-color: var(--black);
    box-shadow: 0 0 0 0.2rem rgba(0, 0, 0, 0.1);
}

.form-control-lg {
    font-size: 1.125rem;
    padding: 0.75rem 1rem;
}

.input-group-text {
    background: var(--gray-100);
    border-color: var(--gray-300);
    font-weight: 500;
}

.alert {
    border-radius: 0.75rem;
    border: none;
}
</style>
