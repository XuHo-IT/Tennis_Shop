@model IEnumerable<BussinessObject.Product>
@{
    ViewData["Title"] = "Products Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h3 mb-1"><i class="fas fa-box me-2"></i>Products Management</h2>
            <p class="text-muted mb-0">Manage your product inventory</p>
        </div>
        <a asp-controller="Admin" asp-action="CreateProduct" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add New Product
        </a>
    </div>

    <!-- Stats Summary -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Total Products</p>
                            <h4 class="mb-0 fw-bold">@Model.Count()</h4>
                        </div>
                        <div class="fs-2 text-black-50">
                            <i class="fas fa-box"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Active Products</p>
                            <h4 class="mb-0 fw-bold">@Model.Count(p => p.IsActive == true)</h4>
                        </div>
                        <div class="fs-2 text-black-50">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Low Stock</p>
                            <h4 class="mb-0 fw-bold">@Model.Count(p => p.Stock < 20)</h4>
                        </div>
                        <div class="fs-2 text-black-50">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-1 small">Out of Stock</p>
                            <h4 class="mb-0 fw-bold">@Model.Count(p => p.Stock == 0)</h4>
                        </div>
                        <div class="fs-2 text-black-50">
                            <i class="fas fa-times-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card admin-card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table admin-table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Brand</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model)
                        {
                            <tr>
                                <td><strong>@product.Id</strong></td>
                                <td>
                                    @if (product.ProductImages?.Any() == true)
                                    {
                                        <img src="@product.ProductImages.First().ImageUrl" 
                                             alt="@product.Name" 
                                             class="product-image-thumb">
                                    }
                                    else
                                    {
                                        <div class="bg-light d-flex align-items-center justify-content-center" 
                                             style="width: 50px; height: 50px; border-radius: 0.5rem; border: 1px solid var(--gray-200);">
                                            <i class="fas fa-image text-muted"></i>
                                        </div>
                                    }
                                </td>
                                <td>
                                    <div>
                                        <strong>@product.Name</strong>
                                        @if (!string.IsNullOrEmpty(product.Description))
                                        {
                                            <br />
                                            <small class="text-muted">@(product.Description.Length > 50 ? product.Description.Substring(0, 50) + "..." : product.Description)</small>
                                        }
                                    </div>
                                </td>
                                <td>@product.Category?.Name</td>
                                <td>@product.Brand?.Name</td>
                                <td>
                                    <strong>$@product.BasePrice.ToString("F2")</strong>
                                    @if (product.DiscountPercent.HasValue && product.DiscountPercent > 0)
                                    {
                                        <br />
                                        <small class="text-success">@product.DiscountPercent% off</small>
                                    }
                                </td>
                                <td>
                                    @{
                                        var stockClass = product.Stock > 50 ? "success" : product.Stock > 20 ? "warning" : "danger";
                                    }
                                    <span class="badge bg-@stockClass">@product.Stock</span>
                                </td>
                                <td>
                                    <span class="badge bg-@(product.IsActive == true ? "success" : "secondary")">
                                        @(product.IsActive == true ? "Active" : "Inactive")
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="@Url.Action("Details", "Product", new { id = product.Id })" 
                                           class="btn btn-sm btn-info" target="_blank" title="View on Store">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="@Url.Action("EditProduct", "Admin", new { id = product.Id })" 
                                           class="btn btn-sm btn-primary" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form method="post" action="@Url.Action("DeleteProduct", "Admin", new { id = product.Id })" 
                                              style="display: inline;">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-danger" 
                                                    onclick="return confirm('Are you sure you want to delete this product?')" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
